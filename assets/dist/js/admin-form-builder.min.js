/*!
 * Torro Forms Version 1.0.0-beta.8 (http://torro-forms.com)
 * Licensed under GNU General Public License v3 (http://www.gnu.org/licenses/gpl-3.0.html)
 */
window.torro=window.torro||{},function(e,t,i,n,o,s){"use strict";function r(e){d++,c["builder"+d]=[],this.instanceNumber=d,this.el=e,this.$el=t(this.el)}var l,d=0,a=[],c={};i.extend(r.prototype,{elementTypes:void 0,form:void 0,containers:void 0,elements:void 0,elementChoices:void 0,elementSettings:void 0,formCanvas:void 0,init:function(){return this.$el.length?void e.api.init().done(i.bind(function(){(new e.api.collections.ElementTypes).fetch({data:{context:"edit"},context:this,success:function(n){this.elementTypes=e.Builder.ElementTypes.fromApiCollection(n),"auto-draft"!==t("#original_post_status").val()?new e.api.models.Form({id:parseInt(t("#post_ID").val(),10)}).fetch({data:{context:"edit",_embed:!0},context:this,success:function(e){t(document).ready(i.bind(function(){var t;a.push(this.instanceCount),this.setupInitialData(e.attributes),this.setupViews();for(t in c["builder"+this.instanceCount])c["builder"+this.instanceCount][t](this);delete c["builder"+this.instanceCount]},this))},error:function(){t(document).ready(i.bind(function(){this.fail(s.couldNotLoadData)},this))}}):t(document).ready(i.bind(function(){var e;a.push(this.instanceCount),this.setupInitialData(),this.setupViews();for(e in c["builder"+this.instanceCount])c["builder"+this.instanceCount][e](this);delete c["builder"+this.instanceCount]},this))},error:function(){t(document).ready(i.bind(function(){this.fail(s.couldNotLoadData)},this))}})},this)).fail(i.bind(function(){t(document).ready(i.bind(function(){this.fail(s.couldNotLoadData)},this))},this)):void console.error(s.couldNotInitCanvas)},setupInitialData:function(t){i.contains(a,this.instanceCount)&&(t?(this.form=new e.Builder.FormModel(t),t._embedded.containers&&t._embedded.containers[0]?this.containers=new e.Builder.ContainerCollection(t._embedded.containers[0]):this.containers=new e.Builder.ContainerCollection,t._embedded.elements&&t._embedded.elements[0]?this.elements=new e.Builder.ElementCollection(t._embedded.elements[0]):this.elements=new e.Builder.ElementCollection,t._embedded.element_choices&&t._embedded.element_choices[0]?this.elementChoices=new e.Builder.ElementChoiceCollection(t._embedded.element_choices[0]):this.elementChoices=new e.Builder.ElementChoiceCollection,t._embedded.element_settings&&t._embedded.element_settings[0]?this.elementSettings=new e.Builder.ElementSettingCollection(t._embedded.element_settings[0]):this.elementSettings=new e.Builder.ElementSettingCollection):(this.form=new e.Builder.FormModel,this.containers=new e.Builder.ContainerCollection([{form_id:this.form.get("id"),label:s.defaultContainerLabel.replace("%s","1")}]),this.elements=new e.Builder.ElementCollection,this.elementChoices=new e.Builder.ElementChoiceCollection,this.elementSettings=new e.Builder.ElementSettingCollection))},setupViews:function(){i.contains(a,this.instanceCount)&&(this.formCanvas=new e.Builder.FormCanvasView({el:this.el,model:this.form}),this.formCanvas.views.set(".torro-js-container-tabs",new e.Builder.ContainerTabsView({collection:this.containers})),this.formCanvas.views.set(".torro-js-container-panels",new e.Builder.ContainerPanelsView({collection:this.containers})),this.formCanvas.views.set(".torro-js-container-footer-panels",new e.Builder.ContainerFooterPanelsView({collection:this.containers})),this.formCanvas.render())},onLoad:function(e){return i.isUndefined(c["builder"+this.instanceCount])?void e(this):void c["builder"+this.instanceCount].push(e)},fail:function(t){var i=e.template("failure");this.$el.find(".drag-drop-area").addClass("is-empty").html(i({message:t}))}}),e.Builder=r,e.Builder.getInstance=function(){return l||(l=new r("#torro-form-canvas"),l.init()),l}}(window.torro,window.jQuery,window._,window.Backbone,window.wp,window.torroBuilderI18n),function(e,t){"use strict";function i(e){this.attributes=e}t.extend(i.prototype,{getSlug:function(){return this.attributes.slug},getTitle:function(){return this.attributes.title},getDescription:function(){return this.attributes.description},getIconUrl:function(){return this.attributes.icon_url},isEvaluable:function(){return this.attributes.evaluable},isMultiField:function(){return this.attributes.multifield},getSections:function(){return this.attributes.sections},getFields:function(){return this.attributes.fields}}),e.ElementType=i}(window.torro.Builder,window._),function(e,t){"use strict";function i(e){var t;this.types={};for(t in e)this.types[e[t].getSlug()]=e[t]}t.extend(i.prototype,{get:function(e){if(!t.isUndefined(this.types[e]))return this.types[e]},getAll:function(){return this.types}}),i.fromApiCollection=function(n){var o=[];return n.each(function(i){var n=t.extend({},i.attributes);n._links&&delete n._links,n._embedded&&delete n._embedded,o.push(new e.ElementType(n))}),new i(o)},e.ElementTypes=i}(window.torro.Builder,window._),function(e,t,i,n){"use strict";e.BaseModel=n.Model.extend({links:{},constructor:function(e,o){var s=e||{},r=this.idAttribute||n.Model.prototype.idAttribute||"id";s._links&&(this.links=s._links),s=i.omit(s,["_links","_embedded"]),s[r]||(s[r]=t.generateTempId()),n.Model.apply(this,[s,o])},sync:function(e,t,n){return"create"===e&&t.has(t.idAttribute)&&(n.attrs||(n.attrs=t.toJSON(n)),n.attrs=i.omit(n.attrs,t.idAttribute)),!1},isNew:function(){return!this.has(this.idAttribute)||t.isTempId(this.get(this.idAttribute))}})}(window.torro.Builder,window.torro,window._,window.Backbone),function(e,t,i,n){"use strict";e.BaseCollection=n.Collection.extend({model:e.BaseModel,initialize:function(){this.urlEndpoint&&(this.url=t.api.root+t.api.versionString+this.urlEndpoint)},sync:function(){return!1}})}(window.torro.Builder,window.torro,window._,window.Backbone),function(e){"use strict";e.ContainerModel=e.BaseModel.extend({defaults:{id:0,form_id:0,label:"",sort:0}})}(window.torro.Builder),function(e){"use strict";e.ElementChoiceModel=e.BaseModel.extend({defaults:{id:0,element_id:0,field:"",value:"",sort:0}})}(window.torro.Builder),function(e){"use strict";e.ElementModel=e.BaseModel.extend({defaults:{id:0,container_id:0,label:"",sort:0,type:"textfield"}})}(window.torro.Builder),function(e){"use strict";e.ElementSettingModel=e.BaseModel.extend({defaults:{id:0,element_id:0,name:"",value:""}})}(window.torro.Builder),function(e){"use strict";e.FormModel=e.BaseModel.extend({defaults:{id:0,title:"",slug:"",author:0,status:"draft",timestamp:0,timestamp_modified:0}})}(window.torro.Builder),function(e){"use strict";e.ContainerCollection=e.BaseCollection.extend({model:e.ContainerModel,urlEndpoint:"containers"})}(window.torro.Builder),function(e){"use strict";e.ElementChoiceCollection=e.BaseCollection.extend({model:e.ElementChoiceModel,urlEndpoint:"element_choices"})}(window.torro.Builder),function(e){"use strict";e.ElementCollection=e.BaseCollection.extend({model:e.ElementModel,urlEndpoint:"elements"})}(window.torro.Builder),function(e){"use strict";e.ElementSettingCollection=e.BaseCollection.extend({model:e.ElementSettingModel,urlEndpoint:"element_settings"})}(window.torro.Builder),function(e){"use strict";e.FormCollection=e.BaseCollection.extend({model:e.FormModel,urlEndpoint:"forms"})}(window.torro.Builder),function(e,t,i){"use strict";e.BaseModelView=i.Backbone.View.extend({render:function(){var e;return this.prepare&&(e=this.prepare()),this.views.detach(),this.template&&(e=e||{},this.trigger("prepare",e),this.$el.html(this.template(e))),this.views.render(),this},prepare:function(){return t.extend({},this.model.attributes,this.options)},dispose:function(){return this.undelegateEvents(),this.model&&this.model.off&&this.model.off(null,null,this),this.collection&&this.collection.off&&this.collection.off(null,null,this),this},remove:function(){return this.dispose(),i.Backbone.View.prototype.remove.apply(this,arguments)}})}(window.torro.Builder,window._,window.wp),function(e,t,i){"use strict";e.BaseCollectionView=i.Backbone.View.extend({modelView:e.BaseModelView,initialize:function(){this._viewsByCid={},this.collection.on("add",function(e){1===this.collection.length&&this.$el.removeClass("is-empty"),this.views.add(this.createModelView(e),{at:this.collection.indexOf(e)})},this),this.collection.on("remove",function(e){var t=this._viewsByCid[e.cid];delete this._viewsByCid[e.cid],this.collection.length||this.$el.addClass("is-empty"),t&&t.remove()},this),this.collection.on("reset",this.render,this)},createModelView:function(e){var t=new this.modelView({model:e,collection:this.collection});return this._viewsByCid[e.cid]=t},render:function(){var e;return this.prepare&&(e=this.prepare()),this.views.detach(),this.collection.length?(this.$el.removeClass("is-empty"),this.template&&(e=e||{},this.trigger("prepare",e),this.$el.html(this.template(e)))):(this.$el.addClass("is-empty"),this.emptyTemplate&&(e=e||{},this.trigger("prepare",e),this.$el.html(this.emptyTemplate(e)))),this.views.render(),this},prepare:function(){return this.collection.length?this.views.set(this.collection.map(this.createModelView,this)):this.views.unset(),this.options},dispose:function(){return this.collection&&this.collection.props&&this.collection.props.off&&this.collection.props.off(null,null,this),this.undelegateEvents(),this.model&&this.model.off&&this.model.off(null,null,this),this.collection&&this.collection.off&&this.collection.off(null,null,this),this},remove:function(){return this.dispose(),i.Backbone.View.prototype.remove.apply(this,arguments)}})}(window.torro.Builder,window._,window.wp),function(e,t){"use strict";e.ContainerFooterPanelView=e.BaseModelView.extend({tagName:"div",className:"torro-form-canvas-panel",template:t.template("container-footer-panel"),attributes:function(){return{id:"container-footer-panel-"+this.model.get("id"),"aria-labelledby":"container-tab-"+this.model.get("id"),"aria-hidden":!0,role:"tabpanel"}}})}(window.torro.Builder,window.torro),function(e,t){"use strict";e.ContainerPanelView=e.BaseModelView.extend({tagName:"div",className:"torro-form-canvas-panel",template:t.template("container-panel"),attributes:function(){return{id:"container-panel-"+this.model.get("id"),"aria-labelledby":"container-tab-"+this.model.get("id"),"aria-hidden":!0,role:"tabpanel"}}})}(window.torro.Builder,window.torro),function(e,t){"use strict";e.ContainerTabView=e.BaseModelView.extend({tagName:"button",className:"torro-form-canvas-tab",template:t.template("container-tab"),attributes:function(){return{type:"button",id:"container-tab-"+this.model.get("id"),"aria-controls":"container-panel-"+this.model.get("id")+" container-footer-panel-"+this.model.get("id"),"aria-selected":!1,role:"tab"}}})}(window.torro.Builder,window.torro),function(e,t){"use strict";e.FormCanvasView=e.BaseModelView.extend({tagName:"div",className:"torro-form-canvas",template:t.template("form-canvas")})}(window.torro.Builder,window.torro),function(e){"use strict";e.ContainerFooterPanelsView=e.BaseCollectionView.extend({modelView:e.ContainerFooterPanelView,tagName:"div",className:"torro-form-container-footer-panels"})}(window.torro.Builder),function(e,t){"use strict";e.ContainerPanelsView=e.BaseCollectionView.extend({modelView:e.ContainerPanelView,tagName:"div",className:"torro-form-container-panels drag-drop-area",emptyTemplate:t.template("empty-container-drag-drop")})}(window.torro.Builder,window.torro),function(e,t){"use strict";e.ContainerTabsView=e.BaseCollectionView.extend({modelView:e.ContainerTabView,tagName:"div",className:"torro-form-container-tabs",attributes:function(){return{role:"tablist"}}})}(window.torro.Builder,window.torro),function(e){"use strict";e.getInstance()}(window.torro.Builder);