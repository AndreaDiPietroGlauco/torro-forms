/*!
 * Torro Forms Version 1.0.0-beta.8 (http://torro-forms.com)
 * Licensed under GNU General Public License v3 (http://www.gnu.org/licenses/gpl-3.0.html)
 */
window.torro=window.torro||{},function(e,t,i,n){"use strict";function o(e){r++,d["builder"+r]=[],this.instanceNumber=r,this.$el=t(e)}var s,r=0,l=[],d={};i.extend(o.prototype,{elementTypes:void 0,form:void 0,view:void 0,init:function(){return this.$el.length?void e.api.init().done(i.bind(function(){(new e.api.collections.ElementTypes).fetch({data:{context:"edit"},context:this,success:function(o){this.elementTypes=e.Builder.ElementTypes.fromApiCollection(o),"auto-draft"!==t("#original_post_status").val()?new e.api.models.Form({id:parseInt(t("#post_ID").val(),10)}).fetch({data:{context:"edit",_embed:!0},context:this,success:function(e){t(document).ready(i.bind(function(){var t;l.push(this.instanceCount),this.setupInitialData(e.attributes),this.setupViews();for(t in d["builder"+this.instanceCount])d["builder"+this.instanceCount][t](this);delete d["builder"+this.instanceCount]},this))},error:function(){t(document).ready(i.bind(function(){this.fail(n.couldNotLoadData)},this))}}):t(document).ready(i.bind(function(){var e;l.push(this.instanceCount),this.setupInitialData(),this.setupViews();for(e in d["builder"+this.instanceCount])d["builder"+this.instanceCount][e](this);delete d["builder"+this.instanceCount]},this))},error:function(){t(document).ready(i.bind(function(){this.fail(n.couldNotLoadData)},this))}})},this)).fail(i.bind(function(){t(document).ready(i.bind(function(){this.fail(n.couldNotLoadData)},this))},this)):void console.error(n.couldNotInitCanvas)},setupInitialData:function(t){var o,s,r,d,u,a;if(i.contains(l,this.instanceCount))if(t){if(this.form=new e.Builder.FormModel(t,{container_label_placeholder:n.defaultContainerLabel}),t._embedded.containers&&t._embedded.containers[0]&&(this.form.containers.add(t._embedded.containers[0]),t._embedded.elements&&t._embedded.elements[0])){for(u={},a=0;a<t._embedded.elements[0].length;a++)s=t._embedded.elements[0][a],o=this.form.containers.get(s.container_id),o&&(o.elements.add(s),u[s.id]=s.container_id);if(t._embedded.element_choices&&t._embedded.element_choices[0])for(a=0;a<t._embedded.element_choices[0].length;a++)r=t._embedded.element_choices[0][a],u[r.element_id]&&(o=this.form.containers.get(u[r.element_id]),o&&(s=o.elements.get(r.element_id),s&&s.element_choices.add(r)));if(t._embedded.element_settings&&t._embedded.element_settings[0])for(a=0;a<t._embedded.element_settings[0].length;a++)d=t._embedded.element_settings[0][a],u[d.element_id]&&(o=this.form.containers.get(u[d.element_id]),o&&(s=o.elements.get(d.element_id),s&&s.element_settings.add(d)))}}else this.form=new e.Builder.FormModel({},{container_label_placeholder:n.defaultContainerLabel}),this.form.containers.add({})},setupViews:function(){i.contains(l,this.instanceCount)&&(this.view=new e.Builder.View(this.$el,this.form,{i18n:n}),this.view.initialize())},onLoad:function(e){return i.isUndefined(d["builder"+this.instanceCount])?void e(this):void d["builder"+this.instanceCount].push(e)},fail:function(t){var i=e.template("failure");this.$el.find(".drag-drop-area").addClass("is-empty").html(i({message:t}))}}),e.Builder=o,e.Builder.getInstance=function(){return s||(s=new o("#torro-form-canvas"),s.init()),s}}(window.torro,window.jQuery,window._,window.torroBuilderI18n),function(e,t){"use strict";function i(e){this.attributes=e}t.extend(i.prototype,{getSlug:function(){return this.attributes.slug},getTitle:function(){return this.attributes.title},getDescription:function(){return this.attributes.description},getIconUrl:function(){return this.attributes.icon_url},isNonInput:function(){return this.attributes.non_input},isEvaluable:function(){return this.attributes.evaluable},isMultiField:function(){return this.attributes.multifield},getSections:function(){return this.attributes.sections},getFields:function(){return this.attributes.fields}}),e.ElementType=i}(window.torro.Builder,window._),function(e,t){"use strict";function i(e){var t;this.types={};for(t in e)this.types[e[t].getSlug()]=e[t]}t.extend(i.prototype,{get:function(e){if(!t.isUndefined(this.types[e]))return this.types[e]},getAll:function(){return this.types}}),i.fromApiCollection=function(n){var o=[];return n.each(function(i){var n=t.extend({},i.attributes);n._links&&delete n._links,n._embedded&&delete n._embedded,o.push(new e.ElementType(n))}),new i(o)},e.ElementTypes=i}(window.torro.Builder,window._),function(e,t,i,n){"use strict";e.BaseModel=n.Model.extend({links:{},constructor:function(e,o){var s=e||{},r=this.idAttribute||n.Model.prototype.idAttribute||"id";s._links&&(this.links=s._links),s=i.omit(s,["_links","_embedded"]),s[r]||(s[r]=t.generateTempId()),n.Model.apply(this,[s,o])},sync:function(e,t,n){return"create"===e&&t.has(t.idAttribute)&&(n.attrs||(n.attrs=t.toJSON(n)),n.attrs=i.omit(n.attrs,t.idAttribute)),!1},isNew:function(){return!this.has(this.idAttribute)||t.isTempId(this.get(this.idAttribute))}})}(window.torro.Builder,window.torro,window._,window.Backbone),function(e,t,i,n){"use strict";e.BaseCollection=n.Collection.extend({model:e.BaseModel,defaultProps:{},constructor:function(e,o){var s=i.defaults(o&&o.props||{},this.defaultProps);this.props=new n.Model(s),this.urlEndpoint&&(this.url=t.api.root+t.api.versionString+this.urlEndpoint),n.Collection.apply(this,arguments)},sync:function(){return!1}})}(window.torro.Builder,window.torro,window._,window.Backbone),function(e,t){"use strict";e.ContainerModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,form_id:0,label:"",sort:0}),this.collection.getDefaultAttributes())},elements:void 0,constructor:function(t,i){e.BaseModel.apply(this,[t,i]),this.elements=new e.ElementCollection([],{props:{container_id:this.get("id")}})}})}(window.torro.Builder,window._),function(e,t){"use strict";e.ElementChoiceModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,element_id:0,field:"",value:"",sort:0}),this.collection.getDefaultAttributes())}})}(window.torro.Builder,window._),function(e,t){"use strict";e.ElementModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,container_id:0,label:"",sort:0,type:"textfield"}),this.collection.getDefaultAttributes())},element_choices:null,element_settings:void 0,constructor:function(t,i){e.BaseModel.apply(this,[t,i]),this.element_choices=new e.ElementChoiceCollection([],{props:{element_id:this.get("id")}}),this.element_settings=new e.ElementSettingCollection([],{props:{element_id:this.get("id")}})}})}(window.torro.Builder,window._),function(e,t){"use strict";e.ElementSettingModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,element_id:0,name:"",value:""}),this.collection.getDefaultAttributes())}})}(window.torro.Builder,window._),function(e){"use strict";e.FormModel=e.BaseModel.extend({defaults:{id:0,title:"",slug:"",author:0,status:"draft",timestamp:0,timestamp_modified:0},containers:void 0,constructor:function(t,i){var n;e.BaseModel.apply(this,[t,i]),n={form_id:this.get("id")},"object"==typeof i&&i.container_label_placeholder&&(n.label_placeholder=i.container_label_placeholder),this.containers=new e.ContainerCollection([],{props:n})}})}(window.torro.Builder),function(e){"use strict";e.ContainerCollection=e.BaseCollection.extend({model:e.ContainerModel,urlEndpoint:"containers",defaultProps:{selected:!1,form_id:0,label_placeholder:"Page %s"},getDefaultAttributes:function(){return{form_id:this.props.get("form_id"),label:this.props.get("label_placeholder").replace("%s",this.length+1),sort:this.length}}})}(window.torro.Builder),function(e){"use strict";e.ElementChoiceCollection=e.BaseCollection.extend({model:e.ElementChoiceModel,urlEndpoint:"element_choices",defaultProps:{element_id:0},getDefaultAttributes:function(){return{element_id:this.props.get("element_id"),sort:this.length}}})}(window.torro.Builder),function(e){"use strict";e.ElementCollection=e.BaseCollection.extend({model:e.ElementModel,urlEndpoint:"elements",defaultProps:{active:!1,container_id:0},getDefaultAttributes:function(){return{container_id:this.props.get("container_id"),sort:this.length}}})}(window.torro.Builder),function(e){"use strict";e.ElementSettingCollection=e.BaseCollection.extend({model:e.ElementSettingModel,urlEndpoint:"element_settings",defaultProps:{element_id:0},getDefaultAttributes:function(){return{element_id:this.props.get("element_id"),sort:this.length}}})}(window.torro.Builder),function(e){"use strict";e.FormCollection=e.BaseCollection.extend({model:e.FormModel,urlEndpoint:"forms"})}(window.torro.Builder),function(e,t,i){"use strict";function n(e,t,i){this.$el=e,this.form=t,this.options=i||{}}i.extend(n.prototype,{initialize:function(){console.log(this.form)}}),e.View=n}(window.torro.Builder,window.jQuery,window._),function(e){"use strict";e(".torro-metabox-tab").on("click",function(t){var i=e(this),n=i.parent().children(".torro-metabox-tab");t.preventDefault(),"true"!==i.attr("aria-selected")&&(n.each(function(){e(this).attr("aria-selected","false"),e(e(this).attr("href")).attr("aria-hidden","true")}),i.attr("aria-selected","true"),e(i.attr("href")).attr("aria-hidden","false").find(".plugin-lib-map-control").each(function(){e(this).wpMapPicker("refresh")}))})}(window.jQuery),function(e){"use strict";e.getInstance()}(window.torro.Builder);