/*!
 * Torro Forms Version 1.0.0alpha1 (http://torro-forms.com)
 * Licensed under GNU General Public License v3 (http://www.gnu.org/licenses/gpl-3.0.html)
 */
!function(t,e,i,n){"use strict";function r(t){this.translations=t,this.selectors={participants:"#form-participants",participants_counter:"#form-participants-count",participants_status:"#form-participants-status p",participants_list:"#torro-participants",participant_sub:".participant",invite_button:"#torro-invite-participants-button",reinvite_button:"#torro-reinvite-participants-button",invite_email:"#torro-invite-email",invite_email_input_from_name:"#torro-invite-email input[name=invite_from_name]",invite_email_input_from:"#torro-invite-email input[name=invite_from]",invite_email_input_subject:"#torro-invite-email input[name=invite_subject]",invite_email_input_text:"#invite_text",reinvite_email:"#torro-reinvite-email",reinvite_email_input_from_name:"#torro-reinvite-email input[name=reinvite_from_name]",reinvite_email_input_from:"#torro-reinvite-email input[name=reinvite_from]",reinvite_email_input_subject:"#torro-reinvite-email input[name=reinvite_subject]",reinvite_email_input_text:"#reinvite_text",invite_send:"#torro-send-invitations-button",invite_request_text:"#invites-send-request-text",invite_close:"#invite-close",participants_slider:"#torro-participants .torro-slider",participants_slider_middle:"#torro-participants .torro-slider-middle",participants_slider_left:"#torro-participants .torro-slider-left",participants_slider_right:"#torro-participants .torro-slider-right",participants_slider_navigation:"#torro-participants .torro-slider-navigation",participants_slider_navigation_prev:"#torro-participants .torro-slider-navigation .torro-nav-prev-link .torro-nav-button",participants_slider_navigation_next:"#torro-participants .torro-slider-navigation .torro-nav-next-link .torro-nav-button",delete_participant_button:".form-delete-participant",add_members_option:"#form-add-participants-option",add_members_button:"#form-add-participants-button",remove_all_members_button:".form-remove-all-participants",nothing_found:".no-users-found"}}r.prototype={init:function(){this.init_invitations(),this.init_add_members(),this.init_remove_members(),this.init_nav_link(),this.refresh_nothing_found()},init_nav_link:function(){var t=this;i(t.selectors.participants_slider_navigation_next).on("click",t.participants,function(n){n.preventDefault();var r=i(this);r.addClass("button-loading");var s=i(this).attr("href");e.ajax.post("torro_get_participants_list",{nonce:t.translations.nonce_get_participants_list,form_id:t.get_form_id(),start:t.get_url_param_value(s,"torro-start"),length:t.get_url_param_value(s,"torro-length"),num_results:t.get_url_param_value(s,"torro-num-results")}).done(function(e){i(t.selectors.participants_slider_right).html(e.table),i(t.selectors.participants_slider_middle).animate({marginLeft:"-100%"},500,function(){i(t.selectors.participants_slider_right).animate({marginLeft:"0"},500,function(){i(t.selectors.participants_slider_left).remove(),i(t.selectors.participants_slider_middle).empty().removeClass("torro-slider-middle").addClass("torro-slider-left"),i(t.selectors.participants_slider_right).removeClass("torro-slider-right").addClass("torro-slider-middle"),i(t.selectors.participants_slider_middle).parent().append('<div class="torro-slider-right"></div>'),i(t.selectors.participants_slider_navigation).html(e.navi)})}),t.init_nav_link(),r.removeClass("button-loading")}).fail(function(t){r.removeClass("button-loading"),console.log(t)})}),i(t.selectors.participants_slider_navigation_prev).on("click",t.participants,function(n){n.preventDefault();var r=i(this);r.addClass("button-loading");var s=i(this).attr("href");e.ajax.post("torro_get_participants_list",{nonce:t.translations.nonce_get_participants_list,form_id:t.get_form_id(),start:t.get_url_param_value(s,"torro-start"),length:t.get_url_param_value(s,"torro-length"),num_results:t.get_url_param_value(s,"torro-num-results")}).done(function(e){i(t.selectors.participants_slider_right).remove(),i(t.selectors.participants_slider_left).html(e.table),i(t.selectors.participants_slider_middle).animate({marginLeft:"100%"},500,function(){i(t.selectors.participants_slider_left).animate({marginLeft:"0"},500,function(){i(t.selectors.participants_slider_middle).empty().removeClass("torro-slider-middle").addClass("torro-slider-right"),i(t.selectors.participants_slider_left).removeClass("torro-slider-left").addClass("torro-slider-middle"),i(t.selectors.participants_slider_middle).parent().prepend('<div class="torro-slider-left"></div>'),i(t.selectors.participants_slider_navigation).html(e.navi)})}),t.init_nav_link(),r.removeClass("button-loading")}).fail(function(t){r.removeClass("button-loading"),console.log(t)})})},init_add_members:function(){var t=this;i(document).on("click",this.selectors.add_members_button,function(){var n=i(this);n.addClass("button-loading");var r=i(t.selectors.add_members_option).val();"allmembers"==r&&e.ajax.post("torro_add_participants_allmembers",{nonce:t.translations.nonce_add_participants_allmembers,form_id:t.get_form_id()}).done(function(e){i(t.selectors.participants_list).html(e.html),console.log(e.html),n.removeClass("button-loading")}).fail(function(t){console.log(t)})})},init_remove_members:function(){var t=this;i(document).on("click",this.selectors.remove_all_members_button,function(){i(t.selectors.participants).val(""),t.set_participants_counter(0),i(t.selectors.participants_list).find(t.selectors.participant_sub).remove(),t.refresh_nothing_found()}),i(document).on("click",this.selectors.delete_participant_button,function(){var e=i(this).attr("rel"),n="",r=i(t.selectors.participants).val();r=r.split(","),i.each(r,function(t,i){i!=e&&(n=""===n?i:n+","+i)}),i(t.selectors.participants).val(n),t.set_participants_counter(parseInt(i(t.selectors.participants_counter).val(),10)-1),i(".participant-user-"+e).remove(),t.refresh_nothing_found()})},init_invitations:function(){var t=this,n="none";i(t.selectors.invite_button).on("click",function(){"none"==n||"reinvite"==n?(n="invite",i(t.selectors.reinvite_button).removeClass("active"),i(t.selectors.invite_button).addClass("active"),e.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(e){if(""==i(t.selectors.invite_email_input_from_name).val()&&""==i(t.selectors.invite_email_input_from).val()&&""==i(t.selectors.invite_email_input_subject).val()&&""==i(t.selectors.invite_email_input_text).val()){i(t.selectors.invite_email_input_from_name).val(e.invite_from_name),i(t.selectors.invite_email_input_from).val(e.invite_from),i(t.selectors.invite_email_input_subject).val(e.invite_subject);var n=tinymce.get("invite_text");n&&n instanceof tinymce.Editor&&n.setContent(e.invite_text.replace(/\r?\n/g,"<br />"))}}).fail(function(t){console.error(t)}),i(t.selectors.reinvite_email).hide(),i(t.selectors.invite_email).show(),i(t.selectors.invite_send).show(),i(t.selectors.invite_close).show()):(n="none",i(t.selectors.invite_button).removeClass("active"),i(t.selectors.invite_email).hide(),i(t.selectors.invite_send).hide(),i(t.selectors.invite_close).hide())}),i(t.selectors.reinvite_button).on("click",function(){"none"==n||"invite"==n?(n="reinvite",i(t.selectors.invite_button).removeClass("active"),i(t.selectors.reinvite_button).addClass("active"),e.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(e){if(""==i(t.selectors.reinvite_email_input_from_name).val()&&""==i(t.selectors.reinvite_email_input_from).val()&&""==i(t.selectors.reinvite_email_input_subject).val()&&""==i(t.selectors.reinvite_email_input_text).val()){i(t.selectors.reinvite_email_input_from_name).val(e.invite_from_name),i(t.selectors.reinvite_email_input_from).val(e.invite_from),i(t.selectors.reinvite_email_input_subject).val(e.invite_subject);var n=tinymce.get("reinvite_text");n&&n instanceof tinymce.Editor&&n.setContent(e.invite_text.replace(/\r?\n/g,"<br />"))}}).fail(function(t){console.error(t)}),i(t.selectors.invite_email).hide(),i(t.selectors.reinvite_email).show(),i(t.selectors.invite_send).show(),i(t.selectors.invite_close).show()):(n="none",i(t.selectors.reinvite_button).removeClass("active"),i(t.selectors.reinvite_email).hide(),i(t.selectors.invite_send).hide(),i(t.selectors.invite_close).hide())}),i(t.selectors.invite_close).on("click",function(){i(t.selectors.invite_email).hide(),i(t.selectors.reinvite_email).hide(),i(t.selectors.invite_send).hide(),i(t.selectors.invite_close).hide()}),i(t.selectors.invite_send).on("click",function(){var n=i(this),r=i(t.selectors.invite_request_text);r.dialog({dialogClass:"wp-dialog",modal:!0,autoOpen:!1,closeOnEscape:!0,minHeight:80,buttons:[{text:t.translations.yes,click:function(){i(this).dialog("close"),n.addClass("button-loading");var r="invite";if(i(t.selectors.invite_button).hasClass("active"))var s=i(t.selectors.invite_email_input_from_name).val(),o=i(t.selectors.invite_email_input_from).val(),a=i(t.selectors.invite_email_input_subject).val(),l=i(t.selectors.invite_email_input_text).val();else{r="reinvite";var s=i(t.selectors.reinvite_email_input_from_name).val(),o=i(t.selectors.reinvite_email_input_from).val(),a=i(t.selectors.reinvite_email_input_subject).val(),l=i(t.selectors.reinvite_email_input_text).val()}e.ajax.post("torro_invite_participants",{nonce:t.translations.nonce_invite_participants,form_id:t.get_form_id(),from_name:s,from:o,subject:a,text:l,invitation_type:r}).done(function(e){i("#form-functions-notices").html(t.translations.deleted_results_successfully),i("#form-functions-notices").show(),n.removeClass("button-loading"),i("#form-functions-notices").fadeOut(5e3)}).fail(function(t){console.error(t),n.removeClass("button-loading")})}},{text:t.translations.no,click:function(){i(this).dialog("close")}}]}),r.dialog("open")})},set_participants_counter:function(t){var e=t+" "+this.translations.added_participants;i(this.selectors.participants_status).html(e),i(this.selectors.participants_counter).val(t)},refresh_nothing_found:function(){0<parseInt(i(this.participants_counter).val())?i(this.selectors.nothing_found).hide():i(this.selectors.nothing_found).show()},get_url_param_value:function(t,e){var i=t.split("?");i=i[1],i=i.split("&");for(var n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]==e)return r[1]}},get_form_id:function(){return i("#post_ID").val()}},t.add_extension("access_control_selected_members",new r(n))}(form_builder,wp,jQuery,translation_sm);