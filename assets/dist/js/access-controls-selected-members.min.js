/*!
 * Torro Forms Version 1.0.0alpha1 (http://torro-forms.com)
 * Licensed under GNU General Public License v3 (http://www.gnu.org/licenses/gpl-3.0.html)
 */
!function(t,i,e,n){"use strict";function s(t){this.translations=t,this.selectors={participants:"#form-participants",participants_counter:"#form-participants-count",participants_status:"#form-participants-status p",participants_list:"#form-participants-list",participant_sub:".participant",invite_button:"#torro-invite-participants-button",reinvite_button:"#torro-reinvite-participants-button",invite_email:"#torro-invite-email",invite_email_input_from_name:"#torro-invite-email input[name=torro_invite_from_name]",invite_email_input_from:"#torro-invite-email input[name=torro_invite_from]",invite_email_input_subject:"#torro-invite-email input[name=torro_invite_subject]",invite_email_input_text:"#torro_invite_text",invite_send:"#torro-send-invitations-button",delete_participant_button:".form-delete-participant",add_all_members_button:"#form-add-participants-allmembers-button",remove_all_members_button:".form-remove-all-participants",nothing_found:".no-users-found"}}s.prototype={init:function(){this.init_invitations(),this.refresh_nothing_found();var t=this;e(document).on("click",this.selectors.add_all_members_button,function(){var n=e(this);n.addClass("button-loading"),i.ajax.post("torro_add_participants_allmembers",{nonce:t.translations.nonce_add_participants_allmembers}).done(function(i){var s=e(t.selectors.participants).val();s=s.split(",");var o=0;e.each(i,function(i,n){var a=!1;-1<s.indexOf(n.id)&&(a=!0),0==a&&(s=""===s?n.id:s+","+n.id,e(t.selectors.participants_list).find("tbody").append('<tr class="participant participant-user-'+n.id+' just-added"><td>'+n.id+"</td><td>"+n.user_nicename+"</td><td>"+n.display_name+"</td><td>"+n.user_email+"</td><td>"+t.translations.just_added+'</td><td><a class="button form-delete-participant" rel="'+n.id+'">'+t.translations["delete"]+"</a></td></tr>"),o++)});var a=parseInt(e(t.selectors.participants_counter).val(),10)+o;e(t.selectors.participants).val(s),t.set_participants_counter(a),e(t.selectors.participants_list).show(),t.refresh_nothing_found(),n.removeClass("button-loading")}).fail(function(t){console.log(t)})}),e(document).on("click",this.selectors.remove_all_members_button,function(){e(t.selectors.participants).val(""),t.set_participants_counter(0),e(t.selectors.participants_list).find(t.selectors.participant_sub).remove(),t.refresh_nothing_found()}),e(document).on("click",this.selectors.delete_participant_button,function(){var i=e(this).attr("rel"),n="",s=e(t.selectors.participants).val();s=s.split(","),e.each(s,function(t,e){e!=i&&(n=""===n?e:n+","+e)}),e(t.selectors.participants).val(n),t.set_participants_counter(parseInt(e(t.selectors.participants_counter).val(),10)-1),e(".participant-user-"+i).remove(),t.refresh_nothing_found()})},init_invitations:function(){var t=this,n="none";e(t.selectors.invite_button).on("click",function(){"none"==n?(n="invite",i.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(i){if(""==e(t.selectors.invite_email_input_from_name).val()&&""==e(t.selectors.invite_email_input_from).val()&&""==e(t.selectors.invite_email_input_subject).val()){e(t.selectors.invite_email_input_from_name).val(i.invite_from_name),e(t.selectors.invite_email_input_from).val(i.invite_from),e(t.selectors.invite_email_input_subject).val(i.invite_subject);var n=tinymce.get("torro_invite_text");n&&n instanceof tinymce.Editor&&n.setContent(i.invite_text,{format:"text"})}}).fail(function(t){console.error(t)}),e(t.selectors.invite_email).show(),e(t.selectors.invite_send).show()):(n="none",e(t.selectors.invite_email).hide(),e(t.selectors.invite_send).hide())}),e(t.selectors.reinvite_button).on("click",function(){"none"==n?(n="reinvite",i.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(i){if(""==e(t.selectors.invite_email_input_from_name).val()&&""==e(t.selectors.invite_email_input_from).val()&&""==e(t.selectors.invite_email_input_subject).val()){e(t.selectors.invite_email_input_from_name).val(i.invite_from_name),e(t.selectors.invite_email_input_from).val(i.invite_from),e(t.selectors.invite_email_input_subject).val(i.invite_subject);var n=tinymce.get("torro_invite_text");n&&n instanceof tinymce.Editor&&n.setContent(i.invite_text,{format:"text"})}}).fail(function(t){console.error(t)}),e(t.selectors.invite_email).show(),e(t.selectors.invite_send).show()):(n="none",e(t.selectors.invite_email).hide(),e(t.selectors.invite_send).hide())})},set_participants_counter:function(t){var i=t+" "+this.translations.added_participants;e(this.selectors.participants_status).html(i),e(this.selectors.participants_counter).val(t)},refresh_nothing_found:function(){0<parseInt(e(this.participants_counter).val())?e(this.selectors.nothing_found).hide():e(this.selectors.nothing_found).show()}},t.add_extension("access_control_selected_members",new s(n))}(form_builder,wp,jQuery,translation_sm);