/*!
 * Torro Forms Version 1.0.0alpha1 (http://torro-forms.com)
 * Licensed under GNU General Public License v3 (http://www.gnu.org/licenses/gpl-3.0.html)
 */
!function(t,e,i,n){"use strict";function s(t){this.translations=t,this.selectors={participants:"#form-participants",participants_counter:"#form-participants-count",participants_status:"#form-participants-status p",participants_list:"#form-participants-list",participant_sub:".participant",invite_button:"#torro-invite-participants-button",reinvite_button:"#torro-reinvite-participants-button",invite_email:"#torro-invite-email",invite_email_input_from_name:"#torro-invite-email input[name=invite_from_name]",invite_email_input_from:"#torro-invite-email input[name=invite_from]",invite_email_input_subject:"#torro-invite-email input[name=invite_subject]",invite_email_input_text:"#invite_text",reinvite_email:"#torro-reinvite-email",reinvite_email_input_from_name:"#torro-reinvite-email input[name=reinvite_from_name]",reinvite_email_input_from:"#torro-reinvite-email input[name=reinvite_from]",reinvite_email_input_subject:"#torro-reinvite-email input[name=reinvite_subject]",reinvite_email_input_text:"#reinvite_text",invite_send:"#torro-send-invitations-button",delete_participant_button:".form-delete-participant",add_all_members_button:"#form-add-participants-allmembers-button",remove_all_members_button:".form-remove-all-participants",nothing_found:".no-users-found"}}s.prototype={init:function(){this.init_invitations(),this.refresh_nothing_found();var t=this;i(document).on("click",this.selectors.add_all_members_button,function(){var n=i(this);n.addClass("button-loading"),e.ajax.post("torro_add_participants_allmembers",{nonce:t.translations.nonce_add_participants_allmembers}).done(function(e){var s=i(t.selectors.participants).val();s=s.split(",");var r=0;i.each(e,function(e,n){var a=!1;-1<s.indexOf(n.id)&&(a=!0),0==a&&(s=""===s?n.id:s+","+n.id,i(t.selectors.participants_list).find("tbody").append('<tr class="participant participant-user-'+n.id+' just-added"><td>'+n.id+"</td><td>"+n.user_nicename+"</td><td>"+n.display_name+"</td><td>"+n.user_email+"</td><td>"+t.translations.just_added+'</td><td><a class="button form-delete-participant" rel="'+n.id+'">'+t.translations["delete"]+"</a></td></tr>"),r++)});var a=parseInt(i(t.selectors.participants_counter).val(),10)+r;i(t.selectors.participants).val(s),t.set_participants_counter(a),i(t.selectors.participants_list).show(),t.refresh_nothing_found(),n.removeClass("button-loading")}).fail(function(t){console.log(t)})}),i(document).on("click",this.selectors.remove_all_members_button,function(){i(t.selectors.participants).val(""),t.set_participants_counter(0),i(t.selectors.participants_list).find(t.selectors.participant_sub).remove(),t.refresh_nothing_found()}),i(document).on("click",this.selectors.delete_participant_button,function(){var e=i(this).attr("rel"),n="",s=i(t.selectors.participants).val();s=s.split(","),i.each(s,function(t,i){i!=e&&(n=""===n?i:n+","+i)}),i(t.selectors.participants).val(n),t.set_participants_counter(parseInt(i(t.selectors.participants_counter).val(),10)-1),i(".participant-user-"+e).remove(),t.refresh_nothing_found()})},init_invitations:function(){var t=this,n="none";i(t.selectors.invite_button).on("click",function(){"none"==n||"reinvite"==n?(n="invite",i(t.selectors.reinvite_button).removeClass("active"),i(t.selectors.invite_button).addClass("active"),e.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(e){if(""==i(t.selectors.invite_email_input_from_name).val()&&""==i(t.selectors.invite_email_input_from).val()&&""==i(t.selectors.invite_email_input_subject).val()&&""==i(t.selectors.invite_email_input_text).val()){i(t.selectors.invite_email_input_from_name).val(e.invite_from_name),i(t.selectors.invite_email_input_from).val(e.invite_from),i(t.selectors.invite_email_input_subject).val(e.invite_subject);var n=tinymce.get("invite_text");n&&n instanceof tinymce.Editor&&n.setContent(e.invite_text.replace(/\r?\n/g,"<br />"))}}).fail(function(t){console.error(t)}),i(t.selectors.reinvite_email).hide(),i(t.selectors.invite_email).show(),i(t.selectors.invite_send).show()):(n="none",i(t.selectors.invite_button).removeClass("active"),i(t.selectors.invite_email).hide(),i(t.selectors.invite_send).hide())}),i(t.selectors.reinvite_button).on("click",function(){"none"==n||"invite"==n?(n="reinvite",i(t.selectors.invite_button).removeClass("active"),i(t.selectors.reinvite_button).addClass("active"),e.ajax.post("torro_get_invite_text",{nonce:t.translations.nonce_get_invite_text,invite_type:n}).done(function(e){if(""==i(t.selectors.reinvite_email_input_from_name).val()&&""==i(t.selectors.reinvite_email_input_from).val()&&""==i(t.selectors.reinvite_email_input_subject).val()&&""==i(t.selectors.reinvite_email_input_text).val()){i(t.selectors.reinvite_email_input_from_name).val(e.invite_from_name),i(t.selectors.reinvite_email_input_from).val(e.invite_from),i(t.selectors.reinvite_email_input_subject).val(e.invite_subject);var n=tinymce.get("reinvite_text");n&&n instanceof tinymce.Editor&&n.setContent(e.invite_text.replace(/\r?\n/g,"<br />"))}}).fail(function(t){console.error(t)}),i(t.selectors.invite_email).hide(),i(t.selectors.reinvite_email).show(),i(t.selectors.invite_send).show()):(n="none",i(t.selectors.reinvite_button).removeClass("active"),i(t.selectors.reinvite_email).hide(),i(t.selectors.invite_send).hide())})},set_participants_counter:function(t){var e=t+" "+this.translations.added_participants;i(this.selectors.participants_status).html(e),i(this.selectors.participants_counter).val(t)},refresh_nothing_found:function(){0<parseInt(i(this.participants_counter).val())?i(this.selectors.nothing_found).hide():i(this.selectors.nothing_found).show()}},t.add_extension("access_control_selected_members",new s(n))}(form_builder,wp,jQuery,translation_sm);